---
- name: AUTOMATIC BACKUP OF RUNNING-CONFIG
  hosts: all  # ใช้ all เพราะ Python script ส่ง host มา override
  gather_facts: false
  connection: network_cli
  vars:
    student_id: 66070108
    router_name: "{{ inventory_hostname }}"
    router_ip: "{{ router_ip }}"
    ansible_host: "{{ router_ip }}"

  tasks:
  - name: Show which router IP we are connecting to
    debug:
      msg: "Connecting to router {{ ansible_host }} (from router_ip={{ router_ip }})"

  - name: DISPLAYING THE RUNNING-CONFIG
    ios_command:
      commands:
        - show running-config
    register: config



  - name: SAVE OUTPUT TO ./backups/
    copy:
      content: "{{ config.stdout[0] }}"
      dest: "backups/show_run_{{ student_id }}_{{ router_name }}.txt"
